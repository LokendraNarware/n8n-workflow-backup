{"createdAt":"2025-03-21T16:32:22.831Z","updatedAt":"2025-03-22T11:42:24.492Z","id":"n4YFmFgU9SIlfpeY","name":"Data analysis","active":false,"nodes":[{"parameters":{"rule":{"interval":[{}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-400,-80],"id":"97683484-bcd0-41f1-b628-87e6d862e2a6","name":"Schedule Trigger"},{"parameters":{"authentication":"serviceAccount","documentId":{"__rl":true,"value":"https://docs.google.com/spreadsheets/d/1HoADEFpscAYbsoYpTkq3twNkgZAg2687sqgRgMbjbmo/edit?gid=391089692#gid=391089692","mode":"url"},"sheetName":{"__rl":true,"value":391089692,"mode":"list","cachedResultName":"ANA.","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1HoADEFpscAYbsoYpTkq3twNkgZAg2687sqgRgMbjbmo/edit#gid=391089692"},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[-180,-80],"id":"64a2051f-50e5-4311-97ab-3a02d8ddb032","name":"Google Sheets","credentials":{"googleApi":{"id":"7ra7JIBz2aaHUiKH","name":"Google Sheets account 4"}}},{"parameters":{"jsCode":"// Fetch data from Google Sheets Node\nconst inputData = $input.all(); // Automatically takes input from the previous node\n\n// Function to parse date strings into Date objects\nfunction parseDate(dateStr) {\n    return new Date(dateStr);\n}\n\n// Function to remove ₹ symbol and convert to integer\nfunction parsePayments(paymentStr) {\n    return parseInt(paymentStr.replace(\"₹\", \"\").trim()) || 0;\n}\n\n// Convert data types where necessary\nconst data = inputData.map(member => ({\n    Member_ID: parseInt(member.json[\"Member ID\"]),\n    Name: member.json[\"Name\"],\n    Age: parseInt(member.json[\"Age\"]),\n    Gender: member.json[\"Gender\"],\n    Membership_Type: member.json[\"Membership Type\"],\n    Join_Date: parseDate(member.json[\"Join Date\"]),\n    Last_Visit: parseDate(member.json[\"Last Visit\"]),\n    Total_Visits: parseInt(member.json[\"Total Visits\"]),\n    Payments_Due: parsePayments(member.json[\"Payments Due\"])\n}));\n\n// 1️⃣ Total Members\nconst totalMembers = data.length;\n\n// 2️⃣ Active Members in Last 7 Days\nconst oneWeekAgo = new Date();\noneWeekAgo.setDate(oneWeekAgo.getDate() - 7);\nconst activeMembers = data.filter(member => member.Last_Visit >= oneWeekAgo).length;\n\n// 3️⃣ Average Visits Per Member\nconst averageVisits = data.reduce((sum, member) => sum + member.Total_Visits, 0) / totalMembers;\n\n// 4️⃣ Pending Payments Summary\nconst totalPendingPayments = data.reduce((sum, member) => sum + member.Payments_Due, 0);\nconst membersWithDues = data.filter(member => member.Payments_Due > 0).length;\n\n// 📌 Returning a single summary object\nreturn [{\n    json: {\n        \"Total Members\": totalMembers,\n        \"Active Members (Last 7 Days)\": activeMembers,\n        \"Average Visits Per Member\": averageVisits.toFixed(2),\n        \"Total Pending Payments (₹)\": totalPendingPayments,\n        \"Members with Pending Payments\": membersWithDues\n    }\n}];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[20,-80],"id":"beeb01c4-b2b3-4896-81ba-ffe753a73c08","name":"Code"},{"parameters":{"sendTo":"csbree008@gmail.com","subject":"Gym Membership Summary Report","message":"=Subject: 📊 Gym Membership Summary Report\n\nHello,\n\nHere is the latest membership summary:\n\n👥 Total Member :{{ $json['Total Members'] }}\n✅ Active Members : {{ $json['Active Members (Last 7 Days)'] }}\n📈 Average Visits Per Member: {{ $json['Average Visits Per Member'] }}\n💰 Total Pending Payments: {{ $json['Total Pending Payments (₹)'] }}\n⚠️ Members with Pending Payments: {{ $json['Members with Pending Payments'] }}  \n\nPlease review the details and let me know if any action is required.\n\nBest regards,  \n[Your Name]\n","options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[240,-80],"id":"9325d195-76bf-4f07-9322-4525c2dddd75","name":"Gmail","webhookId":"b6b96eb5-ca5d-4dd8-8174-4e445108c17d","credentials":{"gmailOAuth2":{"id":"ZNBxoE1s7decTXRh","name":"Gmail account"}}}],"connections":{"Schedule Trigger":{"main":[[{"node":"Google Sheets","type":"main","index":0}]]},"Google Sheets":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"Gmail","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"8dc19011-bcd3-400f-978c-4f0bf6d92c99","triggerCount":0,"tags":[{"createdAt":"2025-03-11T03:42:46.764Z","updatedAt":"2025-03-11T03:42:46.764Z","id":"Gw9jAhW1O10zM33b","name":"Completed"},{"createdAt":"2025-03-17T15:54:29.839Z","updatedAt":"2025-03-17T15:54:29.839Z","id":"lqXQZmH0ptknEVlI","name":"Chirag"}]}